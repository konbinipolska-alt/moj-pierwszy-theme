{%- assign section_id = 'multimedia-' | append: section.id -%}
{%- assign margin_vertical = section.settings.margin_vertical | default: 0 -%}
{%- assign margin_horizontal = section.settings.margin_horizontal | default: 0 -%}
{%- assign margin_vertical_mobile = section.settings.margin_vertical_mobile | default: margin_vertical -%}
{%- assign margin_horizontal_mobile = section.settings.margin_horizontal_mobile | default: margin_horizontal -%}
{%- assign padding_vertical = section.settings.padding_vertical | default: 0 -%}
{%- assign padding_horizontal = section.settings.padding_horizontal | default: 0 -%}
{%- assign padding_vertical_mobile = section.settings.padding_vertical_mobile | default: padding_vertical -%}
{%- assign padding_horizontal_mobile = section.settings.padding_horizontal_mobile | default: padding_horizontal -%}
{%- assign media_height = section.settings.media_height | default: 480 -%}
{%- assign media_height_mobile = section.settings.media_height_mobile | default: media_height -%}
{%- assign max_height = section.settings.max_height | default: 900 -%}
{%- assign border_radius = section.settings.border_radius | default: 0 -%}
{%- assign autoplay = section.settings.autoplay -%}
{%- assign loop_video = section.settings.loop_video -%}

<div
  id="{{ section_id }}"
  class="multimedia-section"
  style="
    --margin-vertical: {{ margin_vertical }}px;
    --margin-horizontal: {{ margin_horizontal }}px;
    --margin-vertical-mobile: {{ margin_vertical_mobile }}px;
    --margin-horizontal-mobile: {{ margin_horizontal_mobile }}px;
    --padding-vertical: {{ padding_vertical }}px;
    --padding-horizontal: {{ padding_horizontal }}px;
    --padding-vertical-mobile: {{ padding_vertical_mobile }}px;
    --padding-horizontal-mobile: {{ padding_horizontal_mobile }}px;
    --media-height: {{ media_height }}px;
    --media-height-mobile: {{ media_height_mobile }}px;
    --media-max-height: {{ max_height }}px;
    --border-radius: {{ border_radius }}px;
  "
>
  <div class="multimedia-inner">
    <div class="multimedia-media">
      {%- liquid
        assign uploaded_video = section.settings.video
        assign external_video = section.settings.video_url
        assign image = section.settings.image
        assign alt_text = section.settings.alt_text | default: image.alt | default: 'Materiał multimedialny'
      -%}

      {%- if uploaded_video != blank -%}
        {{ uploaded_video
          | video_tag:
            class: 'multimedia-video',
            image_size: 'master',
            loop: loop_video,
            autoplay: autoplay,
            muted: autoplay,
            controls: section.settings.show_controls
        }}
      {%- elsif external_video != blank -%}
        {{ external_video
          | external_video_tag:
            class: 'multimedia-video',
            image_size: 'master',
            loop: loop_video,
            autoplay: autoplay,
            controls: section.settings.show_controls,
            muted: autoplay
        }}
      {%- elsif image != blank -%}
        {{ image
          | image_url: width: 3200
          | image_tag:
            alt: alt_text,
            class: 'multimedia-image',
            sizes: '100vw',
            widths: '480, 720, 960, 1200, 1600, 2000, 2400, 2800, 3200',
            loading: 'lazy'
        }}
      {%- else -%}
        <div class="multimedia-placeholder">
          {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
          <p>{{ 'Dodaj obraz lub wideo w ustawieniach sekcji.' }}</p>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

<style>
  #{{ section_id }} {
    width: 100%;
    margin: var(--margin-vertical) 0;
  }

  #{{ section_id }} .multimedia-inner {
    width: min(100%, calc(100% - (var(--margin-horizontal) * 2)));
    margin: 0 auto;
    padding: var(--padding-vertical) var(--padding-horizontal);
    box-sizing: border-box;
  }

  #{{ section_id }} .multimedia-media {
    position: relative;
    width: 100%;
    min-height: var(--media-height);
    max-height: var(--media-max-height);
    overflow: hidden;
    border-radius: var(--border-radius);
  }

  #{{ section_id }} .multimedia-video,
  #{{ section_id }} .multimedia-image,
  #{{ section_id }} .multimedia-placeholder {
    width: 100%;
    height: 100%;
    min-height: var(--media-height);
  }

  #{{ section_id }} .multimedia-video,
  #{{ section_id }} .multimedia-image {
    display: block;
    object-fit: {{ section.settings.media_fit | default: 'cover' }};
  }

  #{{ section_id }} .multimedia-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    background: #f5f5f5;
    color: #999999;
    text-align: center;
    padding: 48px;
    box-sizing: border-box;
  }

  @media (max-width: 749px) {
    #{{ section_id }} {
      margin: var(--margin-vertical-mobile) 0;
    }

    #{{ section_id }} .multimedia-inner {
      width: min(100%, calc(100% - (var(--margin-horizontal-mobile) * 2)));
      padding: var(--padding-vertical-mobile) var(--padding-horizontal-mobile);
    }

    #{{ section_id }} .multimedia-media {
      min-height: var(--media-height-mobile);
      max-height: var(--media-height-mobile);
    }
  }
</style>

{% schema %}
{
  "name": "Sekcja: Multimedia",
  "settings": [
    {
      "type": "header",
      "content": "Marginesy sekcji"
    },
    {
      "type": "range",
      "id": "margin_vertical",
      "label": "Margines góra/dół (px)",
      "min": 0,
      "max": 240,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_horizontal",
      "label": "Margines lewo/prawo (px)",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_vertical_mobile",
      "label": "Margines góra/dół (mobile, px)",
      "min": 0,
      "max": 240,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_horizontal_mobile",
      "label": "Margines lewo/prawo (mobile, px)",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 0
    },
    {
      "type": "header",
      "content": "Padding sekcji"
    },
    {
      "type": "range",
      "id": "padding_vertical",
      "label": "Padding góra/dół (px)",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_horizontal",
      "label": "Padding lewo/prawo (px)",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_vertical_mobile",
      "label": "Padding góra/dół (mobile, px)",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_horizontal_mobile",
      "label": "Padding lewo/prawo (mobile, px)",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 0
    },
    {
      "type": "header",
      "content": "Ustawienia multimediów"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Obraz"
    },
    {
      "type": "video",
      "id": "video",
      "label": "Wideo (plik z biblioteki)"
    },
    {
      "type": "video_url",
      "id": "video_url",
      "accept": [
        "youtube",
        "vimeo"
      ],
      "label": "Wideo (YouTube/Vimeo)"
    },
    {
      "type": "text",
      "id": "alt_text",
      "label": "Tekst alternatywny"
    },
    {
      "type": "range",
      "id": "media_height",
      "label": "Wysokość sekcji (px)",
      "min": 240,
      "max": 900,
      "step": 20,
      "default": 480
    },
    {
      "type": "range",
      "id": "media_height_mobile",
      "label": "Wysokość na mobile (px)",
      "min": 200,
      "max": 720,
      "step": 20,
      "default": 360
    },
    {
      "type": "range",
      "id": "max_height",
      "label": "Maksymalna wysokość (px)",
      "min": 240,
      "max": 1200,
      "step": 20,
      "default": 900
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Zaokrąglenie narożników (px)",
      "min": 0,
      "max": 120,
      "step": 2,
      "default": 0
    },
    {
      "type": "select",
      "id": "media_fit",
      "label": "Dopasowanie obiektu",
      "options": [
        {
          "value": "cover",
          "label": "Przytnij (cover)"
        },
        {
          "value": "contain",
          "label": "Dopasuj (contain)"
        },
        {
          "value": "fill",
          "label": "Wypełnij (fill)"
        }
      ],
      "default": "cover"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoodtwarzanie wideo",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "loop_video",
      "label": "Zapętl wideo",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_controls",
      "label": "Pokaż kontrolki wideo",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Sekcja: Multimedia"
    }
  ]
}
{% endschema %}
