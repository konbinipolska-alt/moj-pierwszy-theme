{%- comment -%}
  Sekcja: Logos Bar
  - Pełna szerokość viewportu
  - Minimalne sterowanie marginesem/paddingiem (jak multimedia)
  - Każdy blok ma własne sterowanie rozmiarem (wysokość lub szerokość)
  - Sterowanie odstępami i wyrównaniem całej sekcji
{%- endcomment -%}

{%- liquid
  assign section_id = 'logo-bar-' | append: section.id

  assign margin_all = section.settings.margin_all | default: 48
  assign padding_all = section.settings.padding_all | default: 48

  assign alignment = section.settings.alignment | default: 'center'
  assign gap = section.settings.gap | default: 24

  assign justify_value = 'center'
  case alignment
    when 'left'
      assign justify_value = 'flex-start'
    when 'right'
      assign justify_value = 'flex-end'
  endcase
-%}

<section
  id="{{ section_id }}"
  class="logo-bar-section"
  style="--lb-margin: {{ margin_all }}px; --lb-padding: {{ padding_all }}px; --lb-gap: {{ gap }}px; --lb-justify: {{ justify_value }};"
>
  <div class="logo-bar-container">
    <div class="logo-bar">
      {%- if section.blocks.size > 0 -%}
        {%- for block in section.blocks -%}
          {%- assign logo = block.settings.logo -%}
          {%- assign alt_text = block.settings.alt_text | default: logo.alt | default: 'Logo' -%}
          {%- assign link = block.settings.link -%}
          {%- assign new_tab = block.settings.open_in_new_tab -%}
          {%- assign size_mode = block.settings.size_mode | default: 'height' -%}
          {%- assign item_style = '' -%}
          {%- assign image_style = '' -%}
          {%- assign placeholder_style = '' -%}

          {%- case size_mode -%}
            {%- when 'height' -%}
              {%- assign custom_height = block.settings.custom_height | default: 80 -%}
              {%- if custom_height > 0 -%}
                {%- assign item_style = 'height: ' | append: custom_height | append: 'px;' -%}
                {%- assign image_style = 'height: 100%; width: auto;' -%}
                {%- assign placeholder_style = item_style -%}
              {%- endif -%}
            {%- when 'width' -%}
              {%- assign custom_width = block.settings.custom_width | default: 160 -%}
              {%- if custom_width > 0 -%}
                {%- assign item_style = 'width: ' | append: custom_width | append: 'px;' -%}
                {%- assign image_style = 'width: 100%; height: auto;' -%}
                {%- assign placeholder_style = item_style -%}
              {%- endif -%}
            {%- else -%}
              {%- assign image_style = 'height: auto; width: auto; max-height: 100%; max-width: 100%;' -%}
            {%- endcase -%}

          <div class="logo-bar__item" {{ block.shopify_attributes }}{% if item_style != blank %} style="{{ item_style }}"{% endif %}>
            {%- if logo != blank -%}
              {%- if link != blank -%}
                <a
                  href="{{ link }}"
                  class="logo-bar__link"
                  {% if new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
                >
                  {{ logo
                    | image_url: width: 600
                    | image_tag:
                      alt: alt_text,
                      class: 'logo-bar__image',
                      loading: 'lazy',
                      style: image_style
                  }}
                </a>
              {%- else -%}
                {{ logo
                  | image_url: width: 600
                  | image_tag:
                    alt: alt_text,
                    class: 'logo-bar__image',
                    loading: 'lazy',
                    style: image_style
                }}
              {%- endif -%}
            {%- else -%}
              <div class="logo-bar__placeholder"{% if placeholder_style != blank %} style="{{ placeholder_style }}"{% endif %}>
                {{ 'logo' | placeholder_svg_tag: 'placeholder-svg' }}
                <span>Dodaj logo</span>
              </div>
            {%- endif -%}
          </div>
        {%- endfor -%}
      {%- else -%}
        <div class="logo-bar__empty">
          <p>Dodaj bloki, aby wyświetlić logotypy.</p>
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

<style>
  #{{ section_id }}.logo-bar-section {
    width: 100vw;
    margin: var(--lb-margin) 0;
    margin-left: calc(-50vw + 50%);
  }

  #{{ section_id }} .logo-bar-container {
    width: 100%;
    padding: var(--lb-padding) 0;
    box-sizing: border-box;
  }

  #{{ section_id }} .logo-bar {
    display: flex;
    flex-wrap: wrap;
    justify-content: var(--lb-justify);
    align-items: center;
    gap: var(--lb-gap);
  }

  #{{ section_id }} .logo-bar__item {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  #{{ section_id }} .logo-bar__link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
  }

  #{{ section_id }} .logo-bar__image {
    display: block;
    max-width: 100%;
    max-height: 100%;
  }

  #{{ section_id }} .logo-bar__placeholder,
  #{{ section_id }} .logo-bar__empty {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 16px;
    background: #f5f5f5;
    color: #888;
    border-radius: 8px;
    min-height: 48px;
    min-width: 120px;
    text-align: center;
  }

  @media (max-width: 749px) {
    #{{ section_id }}.logo-bar-section {
      margin-left: 0;
      width: 100%;
    }
    #{{ section_id }} .logo-bar-container {
      padding: calc(var(--lb-padding) * 0.5) 0;
    }
    #{{ section_id }} .logo-bar {
      justify-content: center;
    }
  }
</style>

{% schema %}
{
  "name": "Sekcja: Logos bar",
  "settings": [
    {
      "type": "header",
      "content": "Odstępy sekcji"
    },
    {
      "type": "range",
      "id": "margin_all",
      "label": "Margines (góra/dół) (px)",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 48
    },
    {
      "type": "range",
      "id": "padding_all",
      "label": "Padding (góra/dół) (px)",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 48
    },
    {
      "type": "header",
      "content": "Układ logotypów"
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Wyrównanie",
      "options": [
        { "value": "left", "label": "Do lewej" },
        { "value": "center", "label": "Do środka" },
        { "value": "right", "label": "Do prawej" }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "Odstęp między blokami (px)",
      "min": 0,
      "max": 120,
      "step": 4,
      "default": 24
    }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Logo",
      "settings": [
        {
          "type": "image_picker",
          "id": "logo",
          "label": "Grafika logo"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Tekst alternatywny"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (opcjonalnie)"
        },
        {
          "type": "checkbox",
          "id": "open_in_new_tab",
          "label": "Otwórz w nowej karcie",
          "default": false
        },
        {
          "type": "select",
          "id": "size_mode",
          "label": "Sterowanie rozmiarem",
          "options": [
            { "value": "height", "label": "Ustal wysokość" },
            { "value": "width", "label": "Ustal szerokość" },
            { "value": "auto", "label": "Automatycznie" }
          ],
          "default": "height"
        },
        {
          "type": "range",
          "id": "custom_height",
          "label": "Wysokość (px)",
          "min": 30,
          "max": 240,
          "step": 5,
          "default": 80
        },
        {
          "type": "range",
          "id": "custom_width",
          "label": "Szerokość (px)",
          "min": 40,
          "max": 400,
          "step": 5,
          "default": 160
        }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "Sekcja: Logos bar",
      "blocks": [
        { "type": "logo" },
        { "type": "logo" },
        { "type": "logo" }
      ]
    }
  ]
}
{% endschema %}


