{%- assign section_id = 'logo-grid-' | append: section.id -%}
{%- assign margin_vertical = section.settings.margin_vertical | default: 0 -%}
{%- assign margin_horizontal = section.settings.margin_horizontal | default: 0 -%}
{%- assign margin_vertical_mobile = section.settings.margin_vertical_mobile | default: margin_vertical -%}
{%- assign margin_horizontal_mobile = section.settings.margin_horizontal_mobile | default: margin_horizontal -%}
{%- assign padding_vertical = section.settings.padding_vertical | default: 0 -%}
{%- assign padding_horizontal = section.settings.padding_horizontal | default: 0 -%}
{%- assign padding_vertical_mobile = section.settings.padding_vertical_mobile | default: padding_vertical -%}
{%- assign padding_horizontal_mobile = section.settings.padding_horizontal_mobile | default: padding_horizontal -%}
{%- assign column_gap = section.settings.column_gap | default: 32 -%}
{%- assign row_gap = section.settings.row_gap | default: 24 -%}
{%- assign min_column_width = section.settings.min_column_width | default: 160 -%}
{%- assign alignment = section.settings.alignment | default: 'center' -%}
{%- assign logo_height = section.settings.logo_height | default: 80 -%}
{%- assign logo_height_mobile = section.settings.logo_height_mobile | default: logo_height -%}

{%- assign alignment_class = 'logo-grid--align-' | append: alignment -%}

<div
  id="{{ section_id }}"
  class="logo-grid-section"
  style="
    --section-margin-vertical: {{ margin_vertical }}px;
    --section-margin-horizontal: {{ margin_horizontal }}px;
    --section-padding-vertical: {{ padding_vertical }}px;
    --section-padding-horizontal: {{ padding_horizontal }}px;
    --column-gap: {{ column_gap }}px;
    --row-gap: {{ row_gap }}px;
    --min-column-width: {{ min_column_width }}px;
    --logo-height: {{ logo_height }}px;
    background-color: {{ section.settings.background_color | default: 'transparent' }};
  "
>
  <div class="logo-grid-inner">
    <div class="logo-grid {{ alignment_class }}">
      {%- if section.blocks.size > 0 -%}
        {%- for block in section.blocks -%}
          {%- assign block_margin_vertical = block.settings.margin_vertical | default: 0 -%}
          {%- assign block_margin_horizontal = block.settings.margin_horizontal | default: 0 -%}
          {%- assign block_padding_vertical = block.settings.padding_vertical | default: 0 -%}
          {%- assign block_padding_horizontal = block.settings.padding_horizontal | default: 0 -%}
          <div
            class="logo-grid__item"
            {{ block.shopify_attributes }}
            style="
              --item-padding-vertical: {{ block_padding_vertical }}px;
              --item-padding-horizontal: {{ block_padding_horizontal }}px;
              --item-margin-vertical: {{ block_margin_vertical }}px;
              --item-margin-horizontal: {{ block_margin_horizontal }}px;
            "
          >
            {%- if block.settings.logo != blank -%}
              {%- if block.settings.link != blank -%}
                {%- assign open_in_new_tab = block.settings.open_in_new_tab -%}
                <a
                  href="{{ block.settings.link }}"
                  class="logo-grid__link"
                  {% if open_in_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %}
                  style="justify-content: {{ block.settings.logo_alignment | default: 'center' }};"
                >
                  {{ block.settings.logo
                    | image_url: width: 600
                    | image_tag:
                      alt: block.settings.alt_text | default: block.settings.logo.alt | default: 'Logo',
                      class: 'logo-grid__image',
                      loading: 'lazy'
                  }}
                </a>
              {%- else -%}
                <div
                  class="logo-grid__item-inner"
                  style="justify-content: {{ block.settings.logo_alignment | default: 'center' }};"
                >
                  {{ block.settings.logo
                    | image_url: width: 600
                    | image_tag:
                      alt: block.settings.alt_text | default: block.settings.logo.alt | default: 'Logo',
                      class: 'logo-grid__image',
                      loading: 'lazy'
                  }}
                </div>
              {%- endif -%}
            {%- else -%}
              <div class="logo-grid__placeholder">
                {{ 'logo' | placeholder_svg_tag: 'placeholder-svg' }}
                <span>Dodaj logo w ustawieniach bloku</span>
              </div>
            {%- endif -%}
          </div>
        {%- endfor -%}
      {%- else -%}
        <div class="logo-grid__empty">
          <p>Dodaj bloki z logo, aby wyświetlić zawartość sekcji.</p>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

<style>
  #{{ section_id }} {
    width: 100%;
    box-sizing: border-box;
    margin: var(--section-margin-vertical) var(--section-margin-horizontal);
    padding: var(--section-padding-vertical) var(--section-padding-horizontal);
  }

  #{{ section_id }} .logo-grid-inner {
    display: block;
  }

  #{{ section_id }} .logo-grid {
    display: grid;
    grid-auto-flow: row;
    gap: var(--row-gap) var(--column-gap);
    width: fit-content;
    max-width: 100%;
  }

  #{{ section_id }} .logo-grid.logo-grid--align-left {
    margin-left: 0;
    margin-right: auto;
  }

  #{{ section_id }} .logo-grid.logo-grid--align-center {
    margin-left: auto;
    margin-right: auto;
  }

  #{{ section_id }} .logo-grid.logo-grid--align-right {
    margin-left: auto;
    margin-right: 0;
  }

  #{{ section_id }} .logo-grid__item {
    display: flex;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
    margin: var(--item-margin-vertical) var(--item-margin-horizontal);
    padding: var(--item-padding-vertical) var(--item-padding-horizontal);
  }

  #{{ section_id }} .logo-grid__item-inner,
  #{{ section_id }} .logo-grid__link {
    display: flex;
    align-items: center;
    width: 100%;
  }

  #{{ section_id }} .logo-grid__link {
    text-decoration: none;
  }

  #{{ section_id }} .logo-grid__image {
    height: var(--logo-height);
    width: auto;
    max-width: 100%;
    object-fit: contain;
  }

  #{{ section_id }} .logo-grid__placeholder,
  #{{ section_id }} .logo-grid__empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 32px;
    background: #f5f5f5;
    color: #999999;
    border-radius: 8px;
    text-align: center;
    min-height: var(--logo-height);
  }

  @media (max-width: 749px) {
    #{{ section_id }} {
      --section-margin-vertical: {{ margin_vertical_mobile }}px;
      --section-margin-horizontal: {{ margin_horizontal_mobile }}px;
      --section-padding-vertical: {{ padding_vertical_mobile }}px;
      --section-padding-horizontal: {{ padding_horizontal_mobile }}px;
      --logo-height: {{ logo_height_mobile }}px;
    }

    #{{ section_id }} .logo-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      width: 100%;
      margin-left: 0;
      margin-right: 0;
      justify-items: center;
    }
  }

  @media (min-width: 750px) {
    #{{ section_id }} .logo-grid {
      grid-template-columns: repeat(auto-fit, minmax(var(--min-column-width), max-content));
    }
  }
</style>

{% schema %}
{
  "name": "Sekcja: Logotypy",
  "settings": [
    {
      "type": "header",
      "content": "Marginesy sekcji"
    },
    {
      "type": "range",
      "id": "margin_vertical",
      "label": "Margines góra/dół (px)",
      "min": 0,
      "max": 240,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_horizontal",
      "label": "Margines lewo/prawo (px)",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_vertical_mobile",
      "label": "Margines góra/dół (mobile, px)",
      "min": 0,
      "max": 240,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_horizontal_mobile",
      "label": "Margines lewo/prawo (mobile, px)",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 0
    },
    {
      "type": "header",
      "content": "Padding sekcji"
    },
    {
      "type": "range",
      "id": "padding_vertical",
      "label": "Padding góra/dół (px)",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_horizontal",
      "label": "Padding lewo/prawo (px)",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_vertical_mobile",
      "label": "Padding góra/dół (mobile, px)",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_horizontal_mobile",
      "label": "Padding lewo/prawo (mobile, px)",
      "min": 0,
      "max": 200,
      "step": 4,
      "default": 0
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Kolor tła",
      "default": "transparent"
    },
    {
      "type": "range",
      "id": "column_gap",
      "label": "Odstęp między kolumnami (px)",
      "min": 0,
      "max": 120,
      "step": 4,
      "default": 32
    },
    {
      "type": "range",
      "id": "row_gap",
      "label": "Odstęp między rzędami (px)",
      "min": 0,
      "max": 120,
      "step": 4,
      "default": 24
    },
    {
      "type": "range",
      "id": "min_column_width",
      "label": "Minimalna szerokość kolumny (px)",
      "min": 80,
      "max": 320,
      "step": 10,
      "default": 160
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Wyrównanie sekcji",
      "options": [
        {
          "value": "left",
          "label": "Do lewej"
        },
        {
          "value": "center",
          "label": "Do środka"
        },
        {
          "value": "right",
          "label": "Do prawej"
        }
      ],
      "default": "center"
    }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Logo",
      "settings": [
        {
          "type": "image_picker",
          "id": "logo",
          "label": "Grafika logo"
        },
        {
          "type": "text",
          "id": "alt_text",
          "label": "Tekst alternatywny"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link (opcjonalnie)"
        },
        {
          "type": "checkbox",
          "id": "open_in_new_tab",
          "label": "Otwórz w nowej karcie",
          "default": false
        },
        {
          "type": "select",
          "id": "logo_alignment",
          "label": "Wyrównanie logo",
          "options": [
            {
              "value": "flex-start",
              "label": "Do lewej"
            },
            {
              "value": "center",
              "label": "Do środka"
            },
            {
              "value": "flex-end",
              "label": "Do prawej"
            }
          ],
          "default": "center"
        },
        {
          "type": "range",
          "id": "max_width",
          "label": "Maksymalna szerokość logo (px)",
          "min": 60,
          "max": 320,
          "step": 10,
          "default": 160
        },
        {
          "type": "range",
          "id": "padding_vertical",
          "label": "Padding góra/dół (px)",
          "min": 0,
          "max": 80,
          "step": 2,
          "default": 0
        },
        {
          "type": "range",
          "id": "padding_horizontal",
          "label": "Padding lewo/prawo (px)",
          "min": 0,
          "max": 80,
          "step": 2,
          "default": 0
        },
        {
          "type": "range",
          "id": "margin_vertical",
          "label": "Margines góra/dół (px)",
          "min": 0,
          "max": 80,
          "step": 2,
          "default": 0
        },
        {
          "type": "range",
          "id": "margin_horizontal",
          "label": "Margines lewo/prawo (px)",
          "min": 0,
          "max": 80,
          "step": 2,
          "default": 0
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Sekcja: Logotypy",
      "blocks": [
        {
          "type": "logo"
        },
        {
          "type": "logo"
        },
        {
          "type": "logo"
        }
      ]
    }
  ]
}
{% endschema %}

