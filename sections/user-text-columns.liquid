{%- comment -%}
  Sekcja: Typografia (pozioma i pionowa)
  - Konfiguracja sekcji identyczna jak w highlights (marginesy, siatka, tło, gapy)
  - Dwa typy bloków:
      * horizontal_text – klasyczny tekst LTR
      * vertical_text   – tekst pionowy (writing-mode: vertical-rl) np. dla japońskiego zapisu
  - Każdy blok ma osobne kolory, border, padding, rozmiary czcionek
{%- endcomment -%}

{%- liquid
  assign section_id = 'text-columns-' | append: section.id
  assign background_color = section.settings.background_color | default: '#ffffff'
  assign margins = section.settings.margins | default: 48
  assign gap = section.settings.gap | default: 48
  assign columns = section.settings.columns_per_row | default: 3
  assign size_mode = section.settings.size_mode | default: 'auto'
  assign block_width = section.settings.block_width | default: 300
  assign block_height = section.settings.block_height | default: 200
-%}

<section
  id="{{ section_id }}"
  class="text-columns-section"
  style="background-color: {{ background_color }};"
>
  <div
    class="text-columns-wrapper text-columns-wrapper--{{ size_mode }}"
    style="
      padding: {{ margins }}px;
      gap: {{ gap }}px;
      {% if size_mode == 'auto' %}
        grid-template-columns: repeat({{ columns }}, minmax(0, 1fr));
      {% else %}
        grid-template-columns: repeat({{ columns }}, minmax(0, {{ block_width }}px));
        grid-auto-rows: {{ block_height }}px;
      {% endif %}
    "
  >
    {%- if section.blocks.size > 0 -%}
      {%- for block in section.blocks -%}
        {%- assign padding = block.settings.padding | default: 0 -%}
        {%- assign block_background = block.settings.background_color -%}
        {%- assign show_border = block.settings.show_border -%}
        {%- assign border_color = block.settings.border_color | default: '#0b00b5' -%}
        {%- assign block_text_color = block.settings.text_color | default: '#0b00b5' -%}
        {%- assign align_horizontal = block.settings.text_alignment | default: 'center' -%}
        {%- assign justify_vertical = block.settings.content_position_vertical | default: 'center' -%}

        {%- case align_horizontal -%}
          {%- when 'left' -%}{%- assign align_items = 'flex-start' -%}
          {%- when 'right' -%}{%- assign align_items = 'flex-end' -%}
          {%- else -%}{%- assign align_items = 'center' -%}
        {%- endcase -%}

        {%- case justify_vertical -%}
          {%- when 'top' -%}{%- assign justify_content = 'flex-start' -%}
          {%- when 'bottom' -%}{%- assign justify_content = 'flex-end' -%}
          {%- else -%}{%- assign justify_content = 'center' -%}
        {%- endcase -%}

        {%- capture block_styles -%}
          padding: {{ padding }}px;
          {% if block_background != blank %}background-color: {{ block_background }};{% endif %}
          {% if show_border %}border: 1px solid {{ border_color }};{% else %}border: none;{% endif %}
        {%- endcapture -%}

        <div
          class="text-columns__item"
          style="{{ block_styles }}"
          {{ block.shopify_attributes }}
        >
          {%- assign text = block.settings.text | default: '' -%}
          {%- assign subtext = block.settings.subtext | default: '' -%}
          {%- assign font_size = block.settings.font_size | default: 24 -%}
          {%- assign sub_font_size = block.settings.sub_font_size | default: 16 -%}
          {%- assign letter_spacing = block.settings.letter_spacing | default: 0 -%}
          <div
            class="text-columns__content"
            style="justify-content: {{ justify_content }}; align-items: {{ align_items }};"
          >
            {%- if text != blank -%}
              <p
                class="text-columns__text"
                style="
                  color: {{ block_text_color }};
                  font-size: {{ font_size }}px;
                  letter-spacing: {{ letter_spacing }}px;
                  text-align: {{ align_horizontal }};
                "
              >
                {{ text | newline_to_br }}
              </p>
            {%- endif -%}
            {%- if subtext != blank -%}
              <p
                class="text-columns__subtext"
                style="
                  color: {{ block_text_color }};
                  font-size: {{ sub_font_size }}px;
                  text-align: {{ align_horizontal }};
                "
              >
                {{ subtext | newline_to_br }}
              </p>
            {%- endif -%}
          </div>
        </div>
      {%- endfor -%}
    {%- else -%}
      <div class="text-columns__empty">
        <p>Dodaj bloki z tekstem poziomym lub pionowym, aby wyświetlić sekcję.</p>
      </div>
    {%- endif -%}
  </div>
</section>

<style>
  #{{ section_id }}.text-columns-section {
    width: 100vw;
    margin-left: calc(-50vw + 50%);
  }

  #{{ section_id }} .text-columns-wrapper {
    width: 100%;
    display: grid;
    box-sizing: border-box;
  }

  #{{ section_id }} .text-columns-wrapper--fixed {
    justify-content: center;
  }

  #{{ section_id }} .text-columns__item {
    position: relative;
    display: flex;
    box-sizing: border-box;
  }

  #{{ section_id }} .text-columns__content {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  #{{ section_id }} .text-columns__text,
  #{{ section_id }} .text-columns__subtext {
    margin: 0;
    width: 100%;
  }

  #{{ section_id }} .text-columns__subtext {
    margin-top: 8px;
  }

  #{{ section_id }} .text-columns__empty {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 48px;
    border-radius: 12px;
    background: #f5f5f5;
    color: #999999;
    text-align: center;
  }

  @media (max-width: 768px) {
    #{{ section_id }} .text-columns-wrapper {
      grid-template-columns: 1fr !important;
    }
  }
</style>

{% schema %}
{
  "name": "Sekcja: Teksty mix",
  "settings": [
    {
      "type": "color",
      "id": "background_color",
      "label": "Kolor tła",
      "default": "#ffffff"
    },
    {
      "type": "number",
      "id": "margins",
      "label": "Marginesy sekcji (px)",
      "default": 48
    },
    {
      "type": "header",
      "content": "Układ bloków"
    },
    {
      "type": "number",
      "id": "gap",
      "label": "Odstęp między blokami (px)",
      "default": 48
    },
    {
      "type": "number",
      "id": "columns_per_row",
      "label": "Ilość kolumn w rzędzie",
      "default": 3
    },
    {
      "type": "select",
      "id": "size_mode",
      "label": "Tryb wymiarów bloków",
      "options": [
        { "value": "auto", "label": "Auto (wypełniają przestrzeń)" },
        { "value": "fixed", "label": "Stałe wymiary w px" }
      ],
      "default": "auto"
    },
    {
      "type": "number",
      "id": "block_width",
      "label": "Szerokość bloku (px)",
      "default": 300,
      "info": "Tylko w trybie stałych wymiarów"
    },
    {
      "type": "number",
      "id": "block_height",
      "label": "Wysokość bloku (px)",
      "default": 200,
      "info": "Tylko w trybie stałych wymiarów"
    }
  ],
  "blocks": [
    {
      "type": "horizontal_text",
      "name": "Tekst",
      "settings": [
        { "type": "header", "content": "Styl bloku" },
        { "type": "color", "id": "background_color", "label": "Kolor tła" },
        {
          "type": "checkbox",
          "id": "show_border",
          "label": "Pokaż ramkę",
          "default": false
        },
        {
          "type": "color",
          "id": "border_color",
          "label": "Kolor ramki",
          "default": "#0b00b5"
        },
        {
          "type": "number",
          "id": "padding",
          "label": "Padding wewnętrzny (px)",
          "default": 24
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Kolor tekstu",
          "default": "#0b00b5"
        },
        { "type": "header", "content": "Treść" },
        {
          "type": "textarea",
          "id": "text",
          "label": "Tekst główny"
        },
        {
          "type": "textarea",
          "id": "subtext",
          "label": "Tekst dodatkowy"
        },
        {
          "type": "select",
          "id": "text_alignment",
          "label": "Wyrównanie tekstu",
          "options": [
            { "value": "left", "label": "Lewo" },
            { "value": "center", "label": "Środek" },
            { "value": "right", "label": "Prawo" }
          ],
          "default": "center"
        },
        {
          "type": "select",
          "id": "content_position_vertical",
          "label": "Pozycja pionowa",
          "options": [
            { "value": "top", "label": "Góra" },
            { "value": "center", "label": "Środek" },
            { "value": "bottom", "label": "Dół" }
          ],
          "default": "center"
        },
        {
          "type": "number",
          "id": "font_size",
          "label": "Rozmiar tekstu (px)",
          "default": 24
        },
        {
          "type": "number",
          "id": "sub_font_size",
          "label": "Rozmiar tekstu dodatkowego (px)",
          "default": 16
        },
        {
          "type": "number",
          "id": "letter_spacing",
          "label": "Odstęp między literami (px)",
          "default": 0
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Sekcja: Teksty poziome i pionowe",
      "blocks": [
        { "type": "horizontal_text" },
        { "type": "vertical_text" },
        { "type": "horizontal_text" }
      ]
    }
  ]
}
{% endschema %}


